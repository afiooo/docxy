# Docxy

![og-image](og-image.png)

[![English](https://img.shields.io/badge/English-Click-orange)](README_EN.md)
[![简体中文](https://img.shields.io/badge/简体中文-点击查看-blue)](README.md)
[![Русский](https://img.shields.io/badge/Русский-Нажмите-orange)](README_RU.md)
[![Español](https://img.shields.io/badge/Español-Clic-blue)](README_ES.md)
[![한국어](https://img.shields.io/badge/한국어-클릭-orange)](README_KR.md)
[![العربية](https://img.shields.io/badge/العربية-انقر-blue)](README_AR.md)
[![Türkçe](https://img.shields.io/badge/Türkçe-Tıkla-orange)](README_TR.md)

خدمة وكيل صور Docker خفيفة الوزن، مصممة لحل مشكلة الوصول المقيد إلى Docker Hub في البر الرئيسي للصين.

> 📢 **برنامج تعليمي للمدونة:** [**قل وداعًا لمهلة اتصال Docker Hub! أنشئ مسرع الصور الحصري الخاص بك باستخدام Docxy**](https://voxsay.com/posts/docxy-docker-proxy-tutorial-for-china/)

## الميزات الأساسية

*   🚀 **نشر بنقرة واحدة**: يوفر برنامجًا نصيًا آليًا `install.sh` لإعداد البيئة بنقرة واحدة، وتطبيق الشهادات (Let's Encrypt)، ونشر الخدمة، دون الحاجة إلى تدخل يدوي.

*   📦 **أوضاع نشر متعددة**:
    *   **مستقل**: وظيفة TLS مدمجة، توفر خدمة HTTPS مباشرة.
    *   **وكيل Nginx**: يمكن أن يعمل مع Nginx كخدمة خلفية.
    *   **أصل CDN**: يدعم وضع HTTP، وهو مناسب لتكامل CDN.

*   ⚡ **تسجيل الدخول لزيادة معدل السحب**: يسمح للمستخدمين بالمصادقة باستخدام حساباتهم الشخصية في Docker Hub عبر `docker login`، مما يزيد من حد معدل السحب للمستخدمين المجهولين (10 سحوبات/ساعة/IP) إلى المستخدمين المصادق عليهم (100 سحب/ساعة/حساب).

*   💎 **وكيل شفاف تمامًا**: متوافق تمامًا مع Docker Registry V2 API. يحتاج العملاء فقط إلى تعديل عنوان مصدر المرآة، دون منحنى تعليمي إضافي أو تغييرات في عادات الاستخدام.

*   🛡️ **أداء عالٍ وأمان**: مبني باستخدام **Rust** و **Actix Web**، مما يوفر أداءً ممتازًا وأمانًا للذاكرة. يستخدم البث لترحيل الصور، مع الحد الأدنى من النفقات العامة.

## التثبيت والنشر

نحن نقدم برنامجًا نصيًا للتثبيت بنقرة واحدة لتبسيط عملية النشر. قبل البدء، يرجى التأكد من حل اسم المجال الخاص بك إلى المضيف الهدف.

```bash
bash <(curl -Ls https://raw.githubusercontent.com/harrisonwang/docxy/main/install.sh)
```

سيرشدك البرنامج النصي خلال التثبيت ويقدم أوضاع النشر الثلاثة التالية:

---

### الوضع الأول: مستقل (HTTPS)

هذا هو الوضع الأبسط والأكثر توصية. سيستمع Docxy مباشرة على المنافذ 80 و 443، ويوفر خدمة وكيل HTTPS كاملة.

**الميزات:**
- لا حاجة لتكوين خادم ويب إضافي.
- يتعامل تلقائيًا مع إعادة توجيه HTTP إلى HTTPS.
- خيار التقديم التلقائي لشهادات Let's Encrypt أو استخدام شهاداتك الخاصة.

**عملية التثبيت:**
1.  قم بتشغيل برنامج التثبيت بنقرة واحدة.
2.  عند المطالبة باختيار الوضع، أدخل `1` أو اضغط Enter ببساطة.
3.  اتبع المطالبات لإدخال اسم المجال الخاص بك واختيار طريقة معالجة الشهادة.
4.  سيكمل البرنامج النصي تلقائيًا جميع التكوينات ويبدأ الخدمة.

---

<details>
<summary>الوضع الثاني: وكيل Nginx العكسي (متقدم)</summary>

### الوضع الثاني: وكيل Nginx العكسي

هذا الوضع مناسب إذا كان لديك بالفعل Nginx وترغب في إدارة خدمات الويب مركزيًا من خلاله.

**الميزات:**
- يتعامل Nginx مع تشفير HTTPS وإدارة الشهادات، مع تشغيل Docxy كخلفية HTTP بسيطة.
- يعمل Docxy كخدمة HTTP خلفية على منفذ محدد (على سبيل المثال، 9000).
- مناسب للتكامل مع الخدمات الأخرى.

**عملية التثبيت:**
1.  قم بتشغيل برنامج التثبيت بنقرة واحدة.
2.  عند المطالبة باختيار الوضع، أدخل `2`.
3.  اتبع المطالبات لإدخال اسم المجال الخاص بك، ومنفذ الاستماع الخلفي لـ Docxy، ومعلومات الشهادة.
4.  سيقوم البرنامج النصي تلقائيًا بإنشاء ملف تكوين Nginx نموذجي لك. ستحتاج إلى إضافته يدويًا إلى تكوين Nginx الخاص بك وإعادة تحميل خدمة Nginx.

</details>

---

<details>
<summary>الوضع الثالث: أصل CDN (HTTP) (متقدم)</summary>

### الوضع الثالث: أصل CDN (HTTP)

هذا الوضع مناسب إذا كنت ترغب في استخدام Docxy كأصل لـ CDN لتحقيق تسريع عالمي أفضل.

**الميزات:**
- يستمع Docxy فقط على منافذ HTTP.
- يتعامل مزود CDN مع طلبات HTTPS والشهادات.
- يثق Docxy ويعالج رؤوس `X-Forwarded-*` لتحديد عنوان IP العميل والبروتوكول بشكل صحيح.

**عملية التثبيت:**
1.  قم بتشغيل برنامج التثبيت بنقرة واحدة.
2.  عند المطالبة باختيار الوضع، أدخل `3`.
3.  اتبع المطالبات لإدخال منفذ HTTP الذي يجب أن يستمع إليه Docxy.
4.  قم بتكوين خدمة CDN الخاصة بك لتوجيه أصلها إلى عنوان ومنفذ خدمة Docxy.

</details>


## استخدام عميل Docker

قم بتكوين عميل Docker الخاص بك لاستخدام خدمة الوكيل الخاصة بك.

### الطريقة الأولى: الاستخدام المجهول (التكوين الأساسي)

هذا هو التكوين الأساسي، الذي يوجه طلبات Docker الافتراضية إلى خدمة الوكيل الخاصة بك.

1.  **تكوين Docker Daemon**

    قم بتحرير ملف `/etc/docker/daemon.json` (أنشئه إذا لم يكن موجودًا) وأضف المحتوى التالي. استبدل `your-domain.com` باسم المجال الخاص بك.

    ```json
    {
      "registry-mirrors": ["https://your-domain.com"]
    }
    ```

2.  **إعادة تشغيل خدمة Docker**

    ```bash
    sudo systemctl restart docker
    ```
    الآن، سيقوم `docker pull` بسحب الصور من خلال الوكيل الخاص بك.

<details>
<summary>الطريقة الثانية: استخدام تسجيل الدخول (زيادة معدل السحب)</summary>

تسمح لك هذه الطريقة بالحصول على معدل سحب صور أعلى عن طريق تسجيل الدخول باستخدام حساب Docker Hub الخاص بك، بالإضافة إلى الاستخدام المجهول.

1.  **إكمال التكوين الأساسي**

    يرجى التأكد من إكمال جميع الخطوات في **الطريقة الأولى**.

2.  **تسجيل الدخول إلى خدمة الوكيل**

    استخدم الأمر `docker login` وأدخل اسم المستخدم وكلمة المرور الخاصين بك في Docker Hub.

    ```bash
    docker login your-domain.com
    ```

3.  **مزامنة معلومات المصادقة**

    بعد تسجيل الدخول بنجاح، تحتاج إلى تحرير ملف `~/.docker/config.json` يدويًا. انسخ معلومات `auth` التي تم إنشاؤها لـ `your-domain.com` والصقها لـ `https://index.docker.io/v1/`.

    قبل التعديل:
    ```json
    {
        "auths": {
            "your-domain.com": {
                "auth": "aBcDeFgHiJkLmNoPqRsTuVwXyZ..."
            }
        }
    }
    ```

    بعد التعديل:
    ```json
    {
        "auths": {
            "your-domain.com": {
                "auth": "aBcDeFgHiJkLmNoPqRsTuVwXyZ..."
            },
            "https://index.docker.io/v1/": {
                "auth": "aBcDeFgHiJkLmNoPqRsTuVwXyZ..."
            }
        }
    }
    ```
    بعد حفظ الملف، سيتم إرسال طلبات `docker pull` الخاصة بك كمستخدم مصادق عليه، وبالتالي ستتمتع بحدود معدل أعلى.

</details>

## التطوير

> [!NOTE]
> للحصول على خلفية تقنية مفصلة، وهندسة النظام، ومبادئ التنفيذ، يرجى الرجوع إلى [**وثيقة البنية التقنية والمبادئ**](docs/ARCHITECTURE.md).

1.  **استنساخ المستودع**
    ```bash
    git clone https://github.com/harrisonwang/docxy.git
    cd docxy
    ```

2.  **تعديل ملف التكوين**
    افتح `config/default.toml` وقم بتعديل قسم `[server]` للتأكد من تمكين خدمة HTTP وتعطيل خدمة HTTPS. يمكنك تعيين المنفذ إلى 8080 لتجنب استخدام المنافذ المميزة في بيئة التطوير.

    ```toml
    # config/default.toml

    [server]
    http_port = 8080      # استخدم منفذ غير مميز
    https_port = 8443
    http_enabled = true   # تمكين HTTP
    https_enabled = false # تعطيل HTTPS
    behind_proxy = true
    ```

3.  **تشغيل المشروع**
    الآن، يمكنك تشغيل المشروع مباشرة باستخدام `cargo`.
    ```bash
    cargo run
    ```
    ستبدأ الخدمة وتستمع على `http://0.0.0.0:8080`.

4.  **بناء إصدار الإصدار**
    ```bash
    cargo build --release
    ```

## الترخيص

هذا المشروع مرخص بموجب ترخيص MIT. راجع [LICENSE](LICENSE) لمزيد من المعلومات.